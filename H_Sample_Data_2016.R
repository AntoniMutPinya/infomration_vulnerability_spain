
source('A_Data_&_Packages.R')


################################################################################
### Demographics
################################################################################



# Select specific columns from the 'ecf_2016' dataset to create the 'df' dataframe
df <- ecf_2016 %>% select(a04, a0000, a1100, a0900b, a0900c, a0900d, 
                          a1500, j1300)

# Age: Replace -98 values (invalid data) with NA, otherwise keep the original value from 'a04'
df$Age <- ifelse(df$a04 == -98, NA, df$a04)

# Educational Background: Replace negative values (invalid data) with NA, otherwise keep the original value from 'a1100'
df$`Educational_Background` <- ifelse(df$a1100 < 0, NA, df$a1100)

# Gender: Directly assign the values from 'a0000' to the 'Gender' column
df$Gender <- df$a0000

# Professional Status: Replace negative values (invalid data) with NA, otherwise keep the original value from 'a1500'
df$`Professional_Status` <- ifelse(df$a1500 < 0, NA, df$a1500)

# Family Income: Replace negative values (invalid data) with NA, otherwise keep the original value from 'j1300'
df$`Family_Income` <- ifelse(df$j1300 < 0, NA, df$j1300)

# Family Unit (Living Situation)
# 'Living with partner': Set to 1 if 'a0900b' > 0, otherwise 0
df$`Living_with_partner` <- ifelse(df$a0900b <= 0, 0 , 1)

# 'Living with children (<18)': Set to 1 if 'a0900c' > 0, otherwise 0
df$`Living_with_children_under_18` <- ifelse(df$a0900c <= 0, 0 , 1)

# 'Living with children (+18)': Set to 1 if 'a0900d' > 0, otherwise 0
df$`Living_with_children_over_18` <- ifelse(df$a0900d <= 0, 0 , 1)

# Loop through each row of the dataframe to determine family situation
for(i in 1:nrow(df)){
  # If not living with a partner and no children, set 'Family Situation' to 0 (No family)
  if(df$`Living_with_partner`[i] == 0 && df$`Living_with_children_under_18`[i] == 0 && 
     df$`Living_with_children_over_18`[i] == 0){
    df$`Family_Situation`[i] <- 0
  }
  # If living with children (under or over 18), set 'Family Situation' to 1
  else if(df$`Living_with_children_under_18`[i] == 1 | df$`Living_with_children_over_18`[i] == 1){
    df$`Family_Situation`[i] <- 1
  }
  # Otherwise, set 'Family Situation' to 2 (Living with partner but no children)
  else{
    df$`Family_Situation`[i] <- 2
  }
}

# Create a new dataframe (df_CV) with the selected control variables (sociodemographic data)
df_CV <- df %>% select(Age, `Educational_Background`, Gender, 
                       `Professional_Status`, `Family_Income`, 
                       `Family_Situation`)

# Add the filter column to df_CV and filter out invalid data
df_CV$filter <- ecf_2016$b0600
df_CV <- df_CV[df_CV$filter != -98, ]

# Clean up memory by removing unnecessary variables
rm(df)

prop.table(table((as.factor(df_CV$Educational_Background))))*100
prop.table(table((as.factor(df_CV$Family_Income))))*100
