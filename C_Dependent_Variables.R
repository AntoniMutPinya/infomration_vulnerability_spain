
# This R script calculates several dependent variables (DV1 to DV5) from a dataset (ecf_2016). 
# The script processes specific variables and transforms them based on various conditions. 
# It performs binary transformations, handles missing data, and calculates summary columns. 
# These dependent variables can then be used for further analysis or modeling. 


# Select column 'b0600' from ecf_2016 and create DV1
DV1 <- ecf_2016 %>% select(b0600)
# Replace values in DV1 that are less than 0 with NaN (to handle missing data)
DV1 <- ifelse(DV1$b0600 < 0, NaN, DV1$b0600)
# Set any values greater than 1 to 0 (binary transformation)
DV1 <- ifelse(DV1 > 1, 0, DV1)

# Select column 'b0600' from ecf_2016 and create DV2
DV2 <- ecf_2016 %>% select(b0600)
# Replace values in DV2 that are less than 0 with NaN (handling missing data)
DV2 <- ifelse(DV2$b0600 < 0, NaN, DV2$b0600)
# If the value is 1 or 2, set it to 1 (binary encoding)
DV2 <- ifelse(DV2 == 1 | DV2 == 2, 1, DV2)
# If the value is greater than 2, set it to 0
DV2 <- ifelse(DV2 > 2, 0, DV2)

# Select specific columns (b0700b to b0700r) from ecf_2016 and store in df
df <- ecf_2016 %>% dplyr::select(b0700b, b0700c, b0700d, b0700e, b0700f, b0700g, 
                                 b0700h, b0700i, b0700a, b0700m, b0700n, b0700o, 
                                 b0700p, b0700q, b0700r)

# Apply binary transformation for columns b0700b to b0700i
# If the value is negative, set it to NA (missing); if greater than 0, set it to 1, otherwise 0
df$b0700b <- ifelse(df$b0700b < 0, NA, ifelse(df$b0700b > 0, 1, 0))
df$b0700c <- ifelse(df$b0700c < 0, NA, ifelse(df$b0700c > 0, 1, 0))
df$b0700d <- ifelse(df$b0700d < 0, NA, ifelse(df$b0700d > 0, 1, 0))
df$b0700e <- ifelse(df$b0700e < 0, NA, ifelse(df$b0700e > 0, 1, 0))
df$b0700f <- ifelse(df$b0700f < 0, NA, ifelse(df$b0700f > 0, 1, 0))
df$b0700g <- ifelse(df$b0700g < 0, NA, ifelse(df$b0700g > 0, 1, 0))
df$b0700h <- ifelse(df$b0700h < 0, NA, ifelse(df$b0700h > 0, 1, 0))
df$b0700i <- ifelse(df$b0700i < 0, NA, ifelse(df$b0700i > 0, 1, 0))

# Apply transformation for columns b0700a to b0700r
# If the value is negative, set it to NA; if greater than 0, set it to -1, otherwise 0
df$b0700a <- ifelse(df$b0700a < 0, NA, ifelse(df$b0700a > 0, -1, 0))
df$b0700m <- ifelse(df$b0700m < 0, NA, ifelse(df$b0700m > 0, -1, 0))
df$b0700n <- ifelse(df$b0700n < 0, NA, ifelse(df$b0700n > 0, -1, 0))
df$b0700o <- ifelse(df$b0700o < 0, NA, ifelse(df$b0700o > 0, -1, 0))
df$b0700p <- ifelse(df$b0700p < 0, NA, ifelse(df$b0700p > 0, -1, 0))
df$b0700q <- ifelse(df$b0700q < 0, NA, ifelse(df$b0700q > 0, -1, 0))
df$b0700r <- ifelse(df$b0700r < 0, NA, ifelse(df$b0700r > 0, -1, 0))

# Create two new columns summing binary variables
# Fuentes_OK: Sum of columns b0700b to b0700i (positive variables)
df$Fuentes_OK <- df$b0700b + df$b0700c + df$b0700d + df$b0700e + df$b0700f + 
  df$b0700g + df$b0700h + df$b0700i

# Fuentes_No_OK: Sum of columns b0700a to b0700r (negative variables)
df$Fuentes_No_OK <- df$b0700a + df$b0700m + df$b0700n + df$b0700o + df$b0700p + 
  df$b0700q + df$b0700r 

# Select the two calculated columns into a new dataframe df_DV_b
df_DV_b <- df %>% select(Fuentes_OK, Fuentes_No_OK)

# Calculate DV3: Fuentes_OK minus Fuentes_No_OK, set values greater than 1 to 1, others to 0
DV3 <- df_DV_b$Fuentes_OK + df_DV_b$Fuentes_No_OK*-1
DV3 <- ifelse(DV3 > 1, 1, 0)

# Calculate DV4: If Fuentes_OK is greater than or equal to 1, set to 1, otherwise 0
DV4 <- ifelse(df$Fuentes_OK >= 1, 1, 0)

# Calculate DV5: Handle missing values in b0700b by replacing negative values with NaN
DV5 <- ifelse(ecf_2016$b0700b < 0, NA, ecf_2016$b0700b)


# Calculate DV6, DV7 and DV8: Handle missing values in b090X by replacing negative values with NaN
DV6 <- ifelse(ecf_2016$b0901 < 0, NA, ecf_2016$b0901)
DV7 <- ifelse(ecf_2016$b0902 < 0, NA, ecf_2016$b0902)
DV8 <- ifelse(ecf_2016$b0903 < 0, NA, ecf_2016$b0903)


# Clean up by removing temporary variables (df and df_DV_b)
rm(df, df_DV_b)



